# –û—Ç—á—ë—Ç –æ –ø—Ä–æ–≤–µ—Ä–∫–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Ü–µ–Ω –¥–ª—è —Å–∞–π—Ç–æ–≤

**–î–∞—Ç–∞**: 6 –¥–µ–∫–∞–±—Ä—è 2025
**–ü—Ä–æ–≤–µ—Ä–∫–∞**: –ì–ª—É–±–æ–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í–°–ï –ü–†–û–í–ï–†–ö–ò –ü–†–û–ô–î–ï–ù–´

---

## üìã –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. Backend - billing.service.js

#### ‚úÖ purchasePlacement() - –°—Ç—Ä–æ–∫–∏ 340-368
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**:
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç `site.price_link` –∏ `site.price_article` –∏–∑ SELECT –∑–∞–ø—Ä–æ—Å–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç fallback –ª–æ–≥–∏–∫—É:
  ```javascript
  basePrice = site.price_link !== null && site.price_link !== undefined
    ? parseFloat(site.price_link)
    : PRICING.LINK_HOMEPAGE; // $25.00 default
  ```
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç NULL –∑–Ω–∞—á–µ–Ω–∏—è
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç —Å–∫–∏–¥–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫ –∫–∞—Å—Ç–æ–º–Ω–æ–π —Ü–µ–Ω–µ

**–í–µ—Ä–¥–∏–∫—Ç**: ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û

#### ‚úÖ renewPlacement() - –°—Ç—Ä–æ–∫–∏ 959, 1007-1010
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**:
- SELECT –≤–∫–ª—é—á–∞–µ—Ç `s.price_link, s.price_article` –≤ —Å—Ç—Ä–æ–∫–µ 959
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—É –∂–µ fallback –ª–æ–≥–∏–∫—É –¥–ª—è renewal:
  ```javascript
  basePrice = placement.price_link !== null && placement.price_link !== undefined
    ? parseFloat(placement.price_link)
    : PRICING.LINK_HOMEPAGE;
  ```
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç BASE_RENEWAL_DISCOUNT + personalDiscount –∫ –∫–∞—Å—Ç–æ–º–Ω–æ–π —Ü–µ–Ω–µ

**–í–µ—Ä–¥–∏–∫—Ç**: ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û

---

### 2. Backend - site.service.js

#### ‚úÖ createSite() - –°—Ç—Ä–æ–∫–∏ 103-115, 171-189
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**:
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç `price_link` –∏ `price_article` –∏–∑ data (—Å—Ç—Ä–æ–∫–∏ 113-114)
- INSERT –≤–∫–ª—é—á–∞–µ—Ç –æ–±–∞ –ø–æ–ª—è –≤ –∫–æ–ª–æ–Ω–∫–∏ (—Å—Ç—Ä–æ–∫–∞ 172)
- –ü–µ—Ä–µ–¥–∞—ë—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
  ```javascript
  price_link !== undefined ? price_link : null,
  price_article !== undefined ? price_article : null
  ```
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç site —Å —Ü–µ–Ω–∞–º–∏

**–í–µ—Ä–¥–∏–∫—Ç**: ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û

#### ‚úÖ updateSite() - –°—Ç—Ä–æ–∫–∏ 201-213, 249-279
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**:
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç `price_link` –∏ `price_article` –∏–∑ data (—Å—Ç—Ä–æ–∫–∏ 211-212)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç COALESCE pattern –¥–ª—è —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
  ```sql
  price_link = COALESCE($10, price_link),
  price_article = COALESCE($11, price_article)
  ```
- –ü–µ—Ä–µ–¥–∞—ë—Ç –∑–Ω–∞—á–µ–Ω–∏—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (—Å—Ç—Ä–æ–∫–∏ 274-275)
- COALESCE –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –ø–æ–ª–µ, –Ω–µ —Ç—Ä–æ–≥–∞—è –≤—Ç–æ—Ä–æ–µ

**–í–µ—Ä–¥–∏–∫—Ç**: ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û

---

### 3. Backend - site.controller.js

#### ‚úÖ createSite() - –°—Ç—Ä–æ–∫–∏ 61-71, 125-158
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**:
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç `price_link` –∏ `price_article` –∏–∑ req.body (—Å—Ç—Ä–æ–∫–∏ 69-70)
- –í–∞–ª–∏–¥–∞—Ü–∏—è:
  ```javascript
  if (price_link !== undefined && price_link !== null && price_link !== '') {
    const linkPrice = parseFloat(price_link);
    if (isNaN(linkPrice) || linkPrice < 0) {
      return res.status(400).json({ error: 'price_link must be a positive number' });
    }
  }
  ```
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤ parseFloat –∏–ª–∏ null –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–¥–∞—á–µ–π –≤ service (—Å—Ç—Ä–æ–∫–∏ 149-156)
- –û—Ç–∫–ª–æ–Ω—è–µ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —Ü–µ–Ω—ã

**–í–µ—Ä–¥–∏–∫—Ç**: ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û

#### ‚úÖ updateSite() - –°—Ç—Ä–æ–∫–∏ 176-187, 233-266
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**:
- –¢–∞ –∂–µ –ª–æ–≥–∏–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∏ 233-246)
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤ parseFloat –∏–ª–∏ **undefined** (–¥–ª—è COALESCE):
  ```javascript
  price_link: price_link !== undefined && price_link !== null && price_link !== ''
    ? parseFloat(price_link)
    : undefined  // –ù–ï null, –∞ undefined –¥–ª—è COALESCE
  ```
- –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è COALESCE - undefined –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª–µ

**–í–µ—Ä–¥–∏–∫—Ç**: ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û

---

### 4. Frontend - sites.html

#### ‚úÖ HTML —Ä–∞–∑–º–µ—Ç–∫–∞ - –°—Ç—Ä–æ–∫–∏ 326-342
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**:
- –ü–æ–ª—è `priceLink` –∏ `priceArticle` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ ID: `id="priceLink"` –∏ `id="priceArticle"`
- Wrapper –¥–ª—è priceArticle: `id="priceArticleField"` (–¥–ª—è show/hide)
- Placeholders –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: "25.00" –∏ "15.00"
- –ü–æ–¥—Å–∫–∞–∑–∫–∏ –æ–±—ä—è—Å–Ω—è—é—Ç —á—Ç–æ –ø—É—Å—Ç–æ–µ –ø–æ–ª–µ = –¥–µ—Ñ–æ–ª—Ç

**–í–µ—Ä–¥–∏–∫—Ç**: ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û

#### ‚úÖ showCreateModal() - –°—Ç—Ä–æ–∫–∏ 829-830
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**:
- –û—á–∏—â–∞–µ—Ç –æ–±–∞ –ø–æ–ª—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Å–∞–π—Ç–∞:
  ```javascript
  document.getElementById('priceLink').value = '';
  document.getElementById('priceArticle').value = '';
  ```

**–í–µ—Ä–¥–∏–∫—Ç**: ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û

#### ‚úÖ editSite() - –°—Ç—Ä–æ–∫–∏ 861-862
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**:
- –ó–∞–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª—è –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏:
  ```javascript
  document.getElementById('priceLink').value =
    site.price_link !== null && site.price_link !== undefined ? site.price_link : '';
  document.getElementById('priceArticle').value =
    site.price_article !== null && site.price_article !== undefined ? site.price_article : '';
  ```
- NULL/undefined –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ –ø—É—Å—Ç—ã–µ –ø–æ–ª—è (–Ω–µ "null" —Å—Ç—Ä–æ–∫–∞)

**–í–µ—Ä–¥–∏–∫—Ç**: ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û

#### ‚úÖ saveSite() - –°—Ç—Ä–æ–∫–∏ 907-922
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**:
- –ü–æ–ª—É—á–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è —Å trim():
  ```javascript
  const priceLinkValue = document.getElementById('priceLink').value.trim();
  const priceArticleValue = document.getElementById('priceArticle').value.trim();
  ```
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤ parseFloat –∏–ª–∏ null:
  ```javascript
  data.price_link = priceLinkValue !== '' ? parseFloat(priceLinkValue) : null;
  data.price_article = priceArticleValue !== '' ? parseFloat(priceArticleValue) : null;
  ```
- –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —á–∏—Å–ª–∞ (—Å—Ç—Ä–æ–∫–∏ 914-922)
- –û—Ç–∫–ª–æ–Ω—è–µ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –Ω–∞ —Ä—É—Å—Å–∫–æ–º

**–í–µ—Ä–¥–∏–∫—Ç**: ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û

#### ‚úÖ toggleSiteTypeFields() - –°—Ç—Ä–æ–∫–∞ 786
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**:
- –°–∫—Ä—ã–≤–∞–µ—Ç priceArticle –¥–ª—è static_php —Å–∞–π—Ç–æ–≤:
  ```javascript
  document.getElementById('priceArticleField').style.display = isWordPress ? 'block' : 'none';
  ```
- Static PHP —Å–∞–π—Ç—ã –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Å—Ç–∞—Ç—å–∏, –ø–æ—ç—Ç–æ–º—É —Ü–µ–Ω–∞ –¥–ª—è —Å—Ç–∞—Ç–µ–π –Ω–µ –Ω—É–∂–Ω–∞

**–í–µ—Ä–¥–∏–∫—Ç**: ‚úÖ –†–ê–ë–û–¢–ê–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û

---

### 5. Frontend - balance.html

#### ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ "–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã"
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**:
- `grep -n "–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã" balance.html` ‚Üí 0 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –°–µ–∫—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω–∞

**–í–µ—Ä–¥–∏–∫—Ç**: ‚úÖ –£–î–ê–õ–ï–ù–û –ü–†–ê–í–ò–õ–¨–ù–û

#### ‚úÖ –ü–æ–∑–∏—Ü–∏—è "–°–∫–∏–¥–∫–∞ –Ω–∞ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ" - –°—Ç—Ä–æ–∫–∏ 53-71
**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ**:
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞:
  1. –°—Ç—Ä–æ–∫–∏ 21-51: –¢—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ (–ë–∞–ª–∞–Ω—Å, **–ü–æ—Ç—Ä–∞—á–µ–Ω–æ –≤—Å–µ–≥–æ**, –°–∫–∏–¥–∫–∞)
  2. **–°—Ç—Ä–æ–∫–∏ 53-71: –°–∫–∏–¥–∫–∞ –Ω–∞ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ** ‚Üê –ó–î–ï–°–¨
  3. –°—Ç—Ä–æ–∫–∏ 73+: –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä, —Ç–∞–±–ª–∏—Ü–∞ —É—Ä–æ–≤–Ω–µ–π, –∏—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

**–í–∏–∑—É–∞–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫**:
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å | –ü–æ—Ç—Ä–∞—á–µ–Ω–æ –≤—Å–µ–≥–æ | –°–∫–∏–¥–∫–∞ ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ       –°–∫–∏–¥–∫–∞ –Ω–∞ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ (40%)         ‚îÇ ‚Üê –í–´–ù–ï–°–ï–ù–û –í–´–®–ï
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ        –ü—Ä–æ–≥—Ä–µ—Å—Å –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–í–µ—Ä–¥–∏–∫—Ç**: ‚úÖ –†–ê–°–ü–û–õ–û–ñ–ï–ù–û –ü–†–ê–í–ò–õ–¨–ù–û

---

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–µ—Å—Ç 1: –°—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü—ã sites
```
‚úÖ price_link: numeric, nullable=YES
‚úÖ price_article: numeric, nullable=YES
```

### –¢–µ—Å—Ç 2: –°–æ–∑–¥–∞–Ω–∏–µ —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏
```
Site #1343
  price_link: $50.00
  price_article: $30.00
‚úÖ –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Ü–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã
```

### –¢–µ—Å—Ç 3: –°–æ–∑–¥–∞–Ω–∏–µ —Å NULL (–¥–µ—Ñ–æ–ª—Ç—ã)
```
Site #1344
  price_link: NULL ‚Üí —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ü–µ–Ω–∞ $25.00
  price_article: NULL ‚Üí —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ü–µ–Ω–∞ $15.00
‚úÖ Fallback —Ä–∞–±–æ—Ç–∞–µ—Ç
```

### –¢–µ—Å—Ç 4: COALESCE –ª–æ–≥–∏–∫–∞
```
Site #1343 (–∫–∞—Å—Ç–æ–º–Ω—ã–µ —Ü–µ–Ω—ã):
  COALESCE(price_link, 25.00) = $50.00 ‚úÖ
  COALESCE(price_article, 15.00) = $30.00 ‚úÖ

Site #1344 (NULL —Ü–µ–Ω—ã):
  COALESCE(price_link, 25.00) = $25.00 ‚úÖ
  COALESCE(price_article, 15.00) = $15.00 ‚úÖ
```

### –¢–µ—Å—Ç 5: –ß–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```
–ë—ã–ª–æ: price_link=NULL, price_article=NULL
UPDATE SET price_link = COALESCE($1, price_link) WHERE id=$2
–ü–∞—Ä–∞–º–µ—Ç—Ä: $1 = 35.50

–°—Ç–∞–ª–æ: price_link=$35.50, price_article=NULL
‚úÖ –¢–æ–ª—å–∫–æ price_link –æ–±–Ω–æ–≤–∏–ª—Å—è, price_article –æ—Å—Ç–∞–ª—Å—è NULL
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –§—É–Ω–∫—Ü–∏–π –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ | –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ | –°—Ç–∞—Ç—É—Å |
|-----------|-------------------|-----------|--------|
| billing.service.js | 2 | ~40 | ‚úÖ |
| site.service.js | 2 | ~180 | ‚úÖ |
| site.controller.js | 2 | ~220 | ‚úÖ |
| sites.html | 4 | ~50 | ‚úÖ |
| balance.html | –°—Ç—Ä—É–∫—Ç—É—Ä–∞ | ~70 | ‚úÖ |

**–í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ**: 10 —Ñ—É–Ω–∫—Ü–∏–π/–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
**–í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞**: ~560 —Å—Ç—Ä–æ–∫
**–¢–µ—Å—Ç–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ**: 5/5

---

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–π –≤–µ—Ä–¥–∏–∫—Ç

### –í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã

1. ‚úÖ **–£–±—Ä–∞–Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞ $25/$15** —Å balance.html
2. ‚úÖ **–û—Å—Ç–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è "–°–∫–∏–¥–∫–∞ –Ω–∞ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ"** (40% = 30% + 10%, –º–∞–∫—Å 60%)
3. ‚úÖ **–°–µ–∫—Ü–∏—è –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤—ã—à–µ "–ü–æ—Ç—Ä–∞—á–µ–Ω–æ –≤—Å–µ–≥–æ"** (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∏–∑—É–∞–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫)
4. ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è price_link –∏ price_article** –≤ —Ç–∞–±–ª–∏—Ü—É sites
5. ‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∞ UI –¥–ª—è –≤–≤–æ–¥–∞ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Ü–µ–Ω** –≤ sites.html
6. ‚úÖ **–î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è $25/$15** —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ COALESCE fallback
7. ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è** –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —Ü–µ–Ω—ã
8. ‚úÖ **–ß–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ COALESCE
9. ‚úÖ **290 —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–∞–π—Ç–æ–≤** —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (NULL ‚Üí defaults)
10. ‚úÖ **–í—Å–µ —Ç–µ—Å—Ç—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ

### –ü—Ä–æ–±–ª–µ–º –Ω–µ –Ω–∞–π–¥–µ–Ω–æ

- –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–¥–µ
- –ù–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ù–µ—Ç –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π –º–µ–∂–¥—É frontend –∏ backend
- –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
- –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å NULL handling
- –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å COALESCE pattern

---

## üíØ –ß–µ—Å—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç

**–î–∞, —è —Å–¥–µ–ª–∞–ª –≤—Å—ë –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞.**

–ü–æ—á–µ–º—É:
1. –Ø –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª Plan Mode –¥–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
2. –Ø –∑–∞–ø—É—Å—Ç–∏–ª 2 Explore –∞–≥–µ–Ω—Ç–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤—Å–µ—Ö –º–µ—Å—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ü–µ–Ω
3. –Ø –ø—Ä–æ–≤–µ—Ä–∏–ª –≤—Å–µ —Ñ–∞–π–ª—ã –≤ –ø–ª–∞–Ω–µ –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
4. –Ø —Å–ª–µ–¥–æ–≤–∞–ª —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã (COALESCE, validation, etc.)
5. –Ø –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
6. –í—Å–µ 5 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ

**–ß—Ç–æ –º–æ–∂–Ω–æ –±—ã–ª–æ —Å–¥–µ–ª–∞—Ç—å –ª—É—á—à–µ**:
- –ù–∏—á–µ–≥–æ –∫—Ä–∏—Ç–∏—á–Ω–æ–≥–æ. –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –Ω–∞–¥–æ.

**–ß—Ç–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å**:
- ‚úÖ 5/5 —Ç–µ—Å—Ç–æ–≤ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–π–¥–µ–Ω—ã
- ‚úÖ 290 —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–∞–π—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ –ö–æ–¥ —Å–ª–µ–¥—É–µ—Ç –≤—Å–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö (frontend, controller, service)
- ‚úÖ NULL handling –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–µ–∑–¥–µ
- ‚úÖ COALESCE pattern —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è fallback –∏ partial updates

---

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏**: 6 –¥–µ–∫–∞–±—Ä—è 2025, 08:40 UTC
**–ü—Ä–æ–≤–µ—Ä—è–ª**: Claude Code (–≥–ª—É–±–æ–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
**–†–µ–∑—É–ª—å—Ç–∞—Ç**: ‚úÖ –í–°–Å –ü–†–ê–í–ò–õ–¨–ù–û
