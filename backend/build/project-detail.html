<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–º - Link Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/modern-table.css">
    <link rel="stylesheet" href="/css/sidebar.css">
    <style>
        body {
            background: #f8f9fa;
        }

        /* –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ */
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            font-size: 13px;
            color: #6b7280;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.2s;
            margin-bottom: 16px;
        }
        .back-btn:hover {
            color: #111827;
            background: #f9fafb;
            border-color: #d1d5db;
        }

        /* –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ö–µ–¥–µ—Ä –ø—Ä–æ–µ–∫—Ç–∞ */
        .project-header-compact {
            background: white;
            border-radius: 12px;
            padding: 16px 20px;
            border: 1px solid #e5e7eb;
            margin-bottom: 16px;
        }
        .project-header-compact h1 {
            font-size: 20px;
            font-weight: 600;
            color: #111827;
            margin: 0 0 4px 0;
        }
        .project-header-compact .domain {
            font-size: 12px;
            color: #9ca3af;
        }

        /* –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border: 1px solid #e5e7eb;
            transition: transform 0.2s, box-shadow 0.2s;
            height: 100%;
        }
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        .stat-icon.blue { background: #dbeafe; color: #2563eb; }
        .stat-icon.green { background: #dcfce7; color: #16a34a; }
        .stat-icon.purple { background: #f3e8ff; color: #9333ea; }
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            line-height: 1;
        }
        .stat-value.blue { color: #2563eb; }
        .stat-value.purple { color: #9333ea; }
        .stat-value.green { color: #16a34a; }
        .stat-label {
            font-size: 11px;
            color: #6b7280;
            margin-bottom: 2px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        /* –ë–ª–æ–∫ —Ç–∏–ø–æ–≤ —Å—Å—ã–ª–æ–∫ */
        .link-types-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            border: 2px solid #e5e7eb;
            margin-bottom: 20px;
        }
        .link-types-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }
        .link-types-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #dbeafe 0%, #f3e8ff 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #c7d2fe;
        }
        .link-types-icon i {
            font-size: 18px;
            color: #6366f1;
        }
        .link-type-box {
            border-radius: 12px;
            padding: 16px;
            transition: all 0.2s;
        }
        .link-type-box:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        .link-type-box.homepage {
            background: linear-gradient(135deg, #dcfce7 0%, #d1fae5 100%);
            border: 2px solid #86efac;
        }
        .link-type-box.article {
            background: linear-gradient(135deg, #f3e8ff 0%, #fce7f3 100%);
            border: 2px solid #d8b4fe;
        }
        .link-type-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .link-type-icon.homepage {
            background: linear-gradient(135deg, #22c55e 0%, #10b981 100%);
        }
        .link-type-icon.article {
            background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);
        }
        .link-type-icon i {
            font-size: 20px;
            color: white;
        }
        .link-type-value {
            font-size: 28px;
            font-weight: 700;
        }
        .link-type-box.homepage .link-type-value { color: #16a34a; }
        .link-type-box.article .link-type-value { color: #9333ea; }

        /* –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±—ã - pill style */
        .modern-tabs {
            background: white;
            border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border: 1px solid #e5e7eb;
            overflow: visible;
        }

        /* Toolbar row with tabs and buttons */
        .tabs-toolbar {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 20px;
            border-bottom: 1px solid #f3f4f6;
            flex-wrap: wrap;
        }

        /* Pill tabs container - no background, just flex row */
        .pill-tabs {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .pill-tab {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            background: transparent;
            color: #6b7280;
            font-weight: 500;
            font-size: 12px;
            transition: all 0.2s;
            cursor: pointer;
            white-space: nowrap;
        }
        .pill-tab:hover {
            background: #f9fafb;
            color: #374151;
        }
        .pill-tab.active {
            background: #eff6ff;
            color: #2563eb;
        }

        /* Toolbar buttons */
        .toolbar-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border: none;
            border-radius: 10px;
            font-weight: 500;
            font-size: 13px;
            transition: all 0.2s;
            cursor: pointer;
            white-space: nowrap;
        }
        .toolbar-btn.secondary {
            background: #f3f4f6;
            color: #374151;
        }
        .toolbar-btn.secondary:hover {
            background: #e5e7eb;
        }
        .toolbar-btn.primary {
            background: linear-gradient(135deg, #8b5cf6 0%, #ec4899 100%);
            color: white;
        }
        .toolbar-btn.primary:hover {
            background: linear-gradient(135deg, #7c3aed 0%, #db2777 100%);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
            transform: translateY(-1px);
        }
        .toolbar-btn i {
            font-size: 16px;
        }

        /* Spacer */
        .toolbar-spacer {
            flex-grow: 1;
        }

        .tab-content-area {
            padding: 20px;
        }

        /* –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ - Dashboard reference style */
        .modern-table {
            margin: 0;
            font-size: 13px;
            width: 100%;
            border-collapse: collapse;
        }
        .modern-table thead {
            background: #f8fafc;
        }
        .modern-table thead th {
            padding: 12px 16px;
            font-size: 11px;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            border-bottom: 1px solid #e5e7eb;
            white-space: nowrap;
        }
        .modern-table tbody tr {
            border-bottom: 1px solid #f1f5f9;
            transition: background-color 0.15s ease;
        }
        .modern-table tbody tr:last-child {
            border-bottom: none;
        }
        .modern-table tbody tr:hover {
            background-color: #f8fafc;
        }
        .modern-table tbody td {
            padding: 12px 16px;
            font-size: 13px;
            color: #334155;
            vertical-align: middle;
        }

        /* Anchor highlight in HTML context */
        .anchor-highlight {
            color: #3b82f6;
            font-weight: 600;
            cursor: pointer;
        }
        .anchor-highlight:hover {
            text-decoration: underline;
            color: #2563eb;
        }

        /* Monospace text for IDs */
        .mono-text {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
        }

        /* Badge –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è */
        .usage-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }
        .usage-badge.available {
            background: #dcfce7;
            color: #166534;
        }
        .usage-badge.partial {
            background: #fef3c7;
            color: #92400e;
        }
        .usage-badge.exhausted {
            background: #f3f4f6;
            color: #6b7280;
        }

        /* –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal-content {
            border-radius: 16px;
            border: none;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
            overflow: hidden;
        }
        .modal-header-gradient {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 50%, #ec4899 100%);
            padding: 20px 24px;
            color: white;
        }
        .modal-header-gradient .modal-icon {
            width: 48px;
            height: 48px;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(8px);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-header-gradient .modal-icon i {
            font-size: 20px;
        }
        .modal-header-gradient .modal-title {
            font-weight: 600;
            font-size: 18px;
            margin: 0;
        }
        .modal-header-gradient .modal-subtitle {
            font-size: 13px;
            opacity: 0.8;
            margin-top: 2px;
        }
        .modal-header-gradient .btn-close {
            filter: brightness(0) invert(1);
            opacity: 0.8;
        }
        .modal-header-gradient .btn-close:hover {
            opacity: 1;
        }
        .modal-body {
            padding: 24px;
        }
        .modal-footer {
            border-top: 1px solid #e5e7eb;
            padding: 16px 24px;
            background: #f9fafb;
        }

        /* Cyan –≥—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ */
        .modal-header-cyan {
            background: linear-gradient(135deg, #06b6d4 0%, #3b82f6 50%, #6366f1 100%);
            padding: 16px 20px;
            color: white;
        }
        .modal-header-cyan .modal-icon {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(8px);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-header-cyan .modal-icon i {
            font-size: 18px;
        }
        .modal-header-cyan .modal-title {
            font-weight: 600;
            font-size: 16px;
            margin: 0;
        }
        .modal-header-cyan .modal-subtitle {
            font-size: 11px;
            opacity: 0.8;
            margin-top: 2px;
        }
        .modal-header-cyan .btn-close {
            filter: brightness(0) invert(1);
            opacity: 0.8;
        }

        /* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∞ */
        .import-instruction {
            background: linear-gradient(135deg, #ecfeff 0%, #dbeafe 50%, #e0e7ff 100%);
            border: 1px solid #67e8f9;
            border-radius: 12px;
            padding: 16px;
        }
        .import-instruction-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .import-instruction-icon i {
            font-size: 14px;
            color: white;
        }
        .requirements-box {
            background: rgba(255,255,255,0.6);
            backdrop-filter: blur(4px);
            border-radius: 8px;
            padding: 12px;
            border: 1px solid #67e8f9;
        }
        .example-box {
            background: linear-gradient(135deg, #e0e7ff 0%, #f3e8ff 100%);
            border-radius: 8px;
            padding: 12px;
            border: 1px solid #a5b4fc;
        }
        .example-code {
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(4px);
            border-radius: 6px;
            padding: 10px;
            font-family: monospace;
            font-size: 10px;
            color: #374151;
            border: 1px solid #c7d2fe;
        }

        /* –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω–∞—è –∫–Ω–æ–ø–∫–∞ */
        .btn-gradient {
            background: linear-gradient(135deg, #8b5cf6 0%, #3b82f6 100%);
            border: none;
            color: white;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            transition: all 0.2s;
        }
        .btn-gradient:hover {
            background: linear-gradient(135deg, #7c3aed 0%, #2563eb 100%);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        }
        .btn-gradient-cyan {
            background: linear-gradient(135deg, #06b6d4 0%, #3b82f6 50%, #6366f1 100%);
            border: none;
            color: white;
            font-weight: 500;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 13px;
            transition: all 0.2s;
        }
        .btn-gradient-cyan:hover {
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.4);
        }
        .btn-gradient-cyan:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* –ö–Ω–æ–ø–∫–∏ –≤ —Ö–µ–¥–µ—Ä–µ —Ç–∞–±–∞ */
        .tab-header-btn {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            color: #374151;
            font-weight: 500;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            transition: all 0.2s;
        }
        .tab-header-btn:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
            color: #111827;
        }
        .tab-header-btn i {
            margin-right: 4px;
        }

        /* Sticky delete button */
        .delete-selected-btn {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 1000;
            padding: 12px 24px;
            font-size: 13px;
            font-weight: 500;
            box-shadow: 0 4px 20px rgba(220, 53, 69, 0.4);
            border-radius: 50px;
            animation: slideInUp 0.3s ease-out;
        }
        .delete-selected-btn:hover {
            box-shadow: 0 8px 25px rgba(220, 53, 69, 0.5);
            transform: translateY(-2px);
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Highlight selected rows */
        .table-active {
            background-color: rgba(139, 92, 246, 0.08) !important;
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
        }
        .empty-state i {
            font-size: 40px;
            color: #d1d5db;
            margin-bottom: 12px;
        }
        .empty-state h5 {
            color: #374151;
            margin-bottom: 8px;
            font-size: 16px;
        }

        /* Form labels with icons */
        .form-label-icon {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 6px;
        }
        .form-label-icon i {
            font-size: 14px;
        }
        .form-label-icon .required {
            color: #ef4444;
        }
        .form-label-icon .optional {
            font-size: 11px;
            font-weight: 400;
            color: #9ca3af;
            background: #f3f4f6;
            padding: 2px 8px;
            border-radius: 10px;
        }

        /* Hint box */
        .hint-box {
            background: linear-gradient(135deg, #fce7f3 0%, #f3e8ff 100%);
            border: 1px solid #f9a8d4;
            border-radius: 10px;
            padding: 10px 12px;
            font-size: 12px;
            color: #374151;
        }
        .hint-box i {
            color: #ec4899;
        }

        /* Quick limit buttons */
        .quick-limit-btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        .quick-limit-btn.active {
            background: #dcfce7;
            color: #166534;
            border-color: #22c55e;
        }
        .quick-limit-btn:not(.active) {
            background: #f3f4f6;
            color: #6b7280;
        }
        .quick-limit-btn:not(.active):hover {
            background: #e5e7eb;
        }

        /* Action buttons (Dashboard style with border) */
        .action-btns {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }
        .action-btn {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            background: white;
            color: #64748b;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.15s;
        }
        .action-btn i {
            font-size: 13px;
        }
        .action-btn:hover {
            background: #f8fafc;
            color: #3b82f6;
            border-color: #3b82f6;
        }
        .action-btn.edit:hover {
            color: #3b82f6;
            border-color: #3b82f6;
        }
        .action-btn.view:hover {
            color: #64748b;
            border-color: #94a3b8;
        }
        .action-btn.duplicate:hover {
            color: #16a34a;
            border-color: #16a34a;
        }
        .action-btn.delete:hover {
            color: #dc2626;
            border-color: #dc2626;
        }
    </style>
</head>
<body>
    <!-- Content will be wrapped by sidebar.js -->

    <div class="container mt-3">
        <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ -->
        <a href="/dashboard.html" class="back-btn">
            <i class="bi bi-arrow-left"></i>
            <span>–ù–∞–∑–∞–¥ –∫ –ø—Ä–æ–µ–∫—Ç–∞–º</span>
        </a>

        <!-- –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ö–µ–¥–µ—Ä –ø—Ä–æ–µ–∫—Ç–∞ -->
        <div class="project-header-compact">
            <h1 id="projectName">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>
            <div class="domain" id="projectDomain"></div>
        </div>

        <!-- –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
        <div class="row g-2 mb-3">
            <div class="col-md-4">
                <div class="stat-card">
                    <div class="d-flex align-items-center">
                        <div class="stat-icon blue me-2">
                            <i class="bi bi-link-45deg"></i>
                        </div>
                        <div>
                            <div class="stat-label">–°—Å—ã–ª–∫–∏</div>
                            <div class="stat-value blue" id="statLinksTotal">0</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card">
                    <div class="d-flex align-items-center">
                        <div class="stat-icon purple me-2">
                            <i class="bi bi-file-text"></i>
                        </div>
                        <div>
                            <div class="stat-label">–ì–µ—Å—Ç-–ø–æ—Å—Ç—ã</div>
                            <div class="stat-value purple" id="statArticlesTotal">0</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card">
                    <div class="d-flex align-items-center">
                        <div class="stat-icon green me-2">
                            <i class="bi bi-check-circle"></i>
                        </div>
                        <div>
                            <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã–µ</div>
                            <div class="stat-value green" id="statActiveTotal">0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ë–ª–æ–∫ —Ç–∏–ø–æ–≤ —Å—Å—ã–ª–æ–∫ -->
        <div class="link-types-card">
            <div class="link-types-header">
                <div class="link-types-icon">
                    <i class="bi bi-link-45deg"></i>
                </div>
                <div>
                    <h5 class="mb-0" style="font-weight: 600; color: #111827;">–¢–∏–ø—ã —Å—Å—ã–ª–æ–∫</h5>
                    <p class="mb-0 small text-muted">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –ø–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—é</p>
                </div>
            </div>
            <div class="row g-3">
                <div class="col-md-6">
                    <div class="link-type-box homepage">
                        <div class="d-flex align-items-center justify-content-between mb-3">
                            <div class="d-flex align-items-center gap-3">
                                <div class="link-type-icon homepage">
                                    <i class="bi bi-house-door"></i>
                                </div>
                                <div>
                                    <h6 class="mb-0 fw-bold" style="color: #111827;">–ì–ª–∞–≤–Ω–∞—è</h6>
                                    <small class="text-muted">–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</small>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex align-items-center justify-content-between pt-3" style="border-top: 2px solid #86efac;">
                            <span class="text-muted small">–†–∞–∑–º–µ—â–µ–Ω–æ:</span>
                            <span class="link-type-value" id="homepageCount">0</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="link-type-box article">
                        <div class="d-flex align-items-center justify-content-between mb-3">
                            <div class="d-flex align-items-center gap-3">
                                <div class="link-type-icon article">
                                    <i class="bi bi-journal-text"></i>
                                </div>
                                <div>
                                    <h6 class="mb-0 fw-bold" style="color: #111827;">–°—Ç–∞—Ç—å—è</h6>
                                    <small class="text-muted">–û—Ç–¥–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç—å—è</small>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex align-items-center justify-content-between pt-3" style="border-top: 2px solid #d8b4fe;">
                            <span class="text-muted small">–†–∞–∑–º–µ—â–µ–Ω–æ:</span>
                            <span class="link-type-value" id="articleCount">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–±—ã -->
        <div class="modern-tabs">
            <!-- Toolbar with pill tabs and buttons -->
            <div class="tabs-toolbar">
                <!-- Pill tabs -->
                <div class="pill-tabs">
                    <button class="pill-tab active" data-tab="linksTab" onclick="switchTab('linksTab', this)" id="linksTabBtn">
                        –°—Å—ã–ª–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ (<span id="linksCount">0</span>)
                    </button>
                    <button class="pill-tab" data-tab="articlesTab" onclick="switchTab('articlesTab', this)" id="articlesTabBtn">
                        –°—Ç–∞—Ç—å–∏ –ø—Ä–æ–µ–∫—Ç–∞ (<span id="articlesCount">0</span>)
                    </button>
                </div>

                <!-- Spacer -->
                <div class="toolbar-spacer"></div>

                <!-- Bulk import button -->
                <button class="toolbar-btn secondary" onclick="showBulkImportModal()">
                    <i class="bi bi-upload"></i>
                    –ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ
                </button>

                <!-- Add button -->
                <button class="toolbar-btn primary" id="addContentBtn" onclick="showAddLinkModal()">
                    <i class="bi bi-plus-lg"></i>
                    –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É
                </button>
            </div>

            <!-- Tab Content -->
            <div class="tab-content-area">
                <!-- Links Tab -->
                <div class="tab-panel active" id="linksTab">
                    <div id="linksList">
                        <div class="text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Articles Tab -->
                <div class="tab-panel" id="articlesTab" style="display: none;">
                    <div id="articlesList">
                        <div class="text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Link Modal - Gradient Design -->
    <div class="modal fade" id="linkModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header-gradient d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center gap-3">
                        <div class="modal-icon">
                            <i class="bi bi-plus-lg"></i>
                        </div>
                        <div>
                            <h5 class="modal-title" id="linkModalTitle">–î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É</h5>
                            <p class="modal-subtitle mb-0">–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é —Å—Å—ã–ª–∫—É –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞</p>
                        </div>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="linkForm">
                        <input type="hidden" id="linkId">

                        <!-- URL -->
                        <div class="mb-4">
                            <label class="form-label-icon">
                                <i class="bi bi-link-45deg text-primary"></i>
                                URL —Å—Å—ã–ª–∫–∏
                                <span class="required">*</span>
                            </label>
                            <input type="url" class="form-control" id="linkUrl" required placeholder="https://example.com/page">
                        </div>

                        <!-- –ê–Ω–∫–æ—Ä -->
                        <div class="mb-4">
                            <label class="form-label-icon">
                                <i class="bi bi-cursor-text" style="color: #8b5cf6;"></i>
                                –ê–Ω–∫–æ—Ä (—Ç–µ–∫—Å—Ç —Å—Å—ã–ª–∫–∏)
                                <span class="required">*</span>
                            </label>
                            <input type="text" class="form-control" id="linkAnchor" required placeholder="–ö—É–ø–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç">
                        </div>

                        <!-- HTML –∫–æ–Ω—Ç–µ–∫—Å—Ç -->
                        <div class="mb-4">
                            <label class="form-label-icon">
                                <i class="bi bi-code-slash" style="color: #ec4899;"></i>
                                HTML —Å –æ–∫—Ä—É–∂–∞—é—â–∏–º —Ç–µ–∫—Å—Ç–æ–º
                                <span class="optional">–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ</span>
                            </label>
                            <div class="hint-box mb-2">
                                <i class="bi bi-lightbulb me-1"></i>
                                –í—ã –º–æ–∂–µ—Ç–µ &lt;a href="..."&gt;–∫—É–ø–∏—Ç—å —Å—Å—ã–ª–∫–∏&lt;/a&gt; –Ω–∞ –Ω–∞—à–µ–º —Å–∞–π—Ç–µ
                            </div>
                            <textarea class="form-control font-monospace" id="linkHtmlContext" rows="3" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω—ã–π HTML –∫–æ–¥ —Å –æ–∫—Ä—É–∂–∞—é—â–∏–º —Ç–µ–∫—Å—Ç–æ–º –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º" style="font-size: 12px;"></textarea>
                            <small class="text-muted d-flex align-items-center gap-1 mt-1">
                                <i class="bi bi-info-circle"></i>
                                –ï—Å–ª–∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ, –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —ç—Ç–æ—Ç HTML. URL –∏ –∞–Ω–∫–æ—Ä –≤—ã—à–µ –±—É–¥—É—Ç –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω—ã
                            </small>
                        </div>

                        <!-- –õ–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è -->
                        <div class="mb-3">
                            <label class="form-label-icon">
                                <i class="bi bi-clock" style="color: #22c55e;"></i>
                                –õ–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
                                <span class="required">*</span>
                            </label>
                            <div class="d-flex align-items-center gap-3">
                                <input type="number" class="form-control" id="linkLimit" value="999" min="1" max="9999" required style="max-width: 120px;">
                                <div class="d-flex gap-2">
                                    <button type="button" class="quick-limit-btn" onclick="setQuickLimit(10)">10</button>
                                    <button type="button" class="quick-limit-btn" onclick="setQuickLimit(50)">50</button>
                                    <button type="button" class="quick-limit-btn active" onclick="setQuickLimit(999)">‚àû</button>
                                </div>
                            </div>
                            <small class="text-muted">–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É —Å—Å—ã–ª–∫—É –≤ —Å—Ç–∞—Ç—å—è—Ö</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer d-flex gap-2">
                    <button type="button" class="btn btn-light px-4" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn btn-gradient flex-grow-1" onclick="saveLink()">
                        <i class="bi bi-check-circle me-1"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Å—ã–ª–∫—É
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Article Modal -->
    <div class="modal fade" id="articleModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="articleModalTitle">–î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—å—é</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="articleForm">
                        <input type="hidden" id="articleId">
                        <div class="mb-3">
                            <label for="articleTitle" class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫ –≥–µ—Å—Ç-–ø–æ—Å—Ç–∞ *</label>
                            <input type="text" class="form-control" id="articleTitle" required placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫">
                        </div>
                        <div class="mb-3">
                            <label for="articleContent" class="form-label">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –≥–µ—Å—Ç-–ø–æ—Å—Ç–∞ *</label>
                            <textarea class="form-control" id="articleContent" rows="10" required placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –≥–µ—Å—Ç-–ø–æ—Å—Ç–∞..."></textarea>
                            <small class="text-muted">–ö–∞–∂–¥—ã–π –≥–µ—Å—Ç-–ø–æ—Å—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Ç–æ–ª—å–∫–æ 1 —Ä–∞–∑</small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn btn-gradient" onclick="saveArticle()">
                        <i class="bi bi-check-lg me-1"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Article Modal -->
    <div class="modal fade" id="viewArticleModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewArticleTitle">–ü—Ä–æ—Å–º–æ—Ç—Ä –≥–µ—Å—Ç-–ø–æ—Å—Ç–∞</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="viewArticleContent" style="white-space: pre-wrap;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Import Modal - Step 1: Input - Cyan Gradient -->
    <div class="modal fade" id="bulkImportModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header-cyan d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center gap-3">
                        <div class="modal-icon">
                            <i class="bi bi-cloud-upload"></i>
                        </div>
                        <div>
                            <h5 class="modal-title">–ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫</h5>
                            <p class="modal-subtitle mb-0">–ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Å—ã–ª–æ–∫ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ</p>
                        </div>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è -->
                    <div class="import-instruction mb-4">
                        <div class="d-flex gap-3">
                            <div class="import-instruction-icon">
                                <i class="bi bi-file-text"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="fw-bold mb-2" style="font-size: 13px;">üìù –§–æ—Ä–º–∞—Ç –≤–≤–æ–¥–∞</h6>
                                <p class="mb-3" style="font-size: 12px; color: #374151;">
                                    –í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –±–ª–æ–∫–∏ —Å HTML —Å—Å—ã–ª–∫–∞–º–∏. –ö–∞–∂–¥—ã–π –±–ª–æ–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏.
                                </p>

                                <div class="requirements-box mb-3">
                                    <h6 class="fw-bold mb-2 d-flex align-items-center gap-1" style="font-size: 11px;">
                                        <i class="bi bi-check-circle text-success"></i> –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ç–µ–∫—Å—Ç—É
                                    </h6>
                                    <div class="row" style="font-size: 10px;">
                                        <div class="col-6 mb-1">
                                            <span class="text-success">‚úì</span> –°–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–≥ <code>&lt;a href&gt;</code>
                                        </div>
                                        <div class="col-6 mb-1">
                                            <span class="text-success">‚úì</span> –î–ª–∏–Ω–∞: 30-250 —Å–∏–º–≤–æ–ª–æ–≤
                                        </div>
                                        <div class="col-6">
                                            <span class="text-success">‚úì</span> –û–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ = –æ–¥–Ω–∞ —Å—Å—ã–ª–∫–∞
                                        </div>
                                        <div class="col-6">
                                            <span class="text-success">‚úì</span> –ë–µ–∑ –¥—É–±–ª–µ–π –∞–Ω–∫–æ—Ä–æ–≤
                                        </div>
                                    </div>
                                </div>

                                <div class="example-box">
                                    <p class="fw-bold mb-2" style="font-size: 11px;">üí° –ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞:</p>
                                    <div class="example-code">
                                        <p class="mb-1">Discover everything about gaming when you &lt;a href="https://example.com/"&gt;go to website&lt;/a&gt; and explore.</p>
                                        <hr class="my-1" style="border-color: #c7d2fe;">
                                        <p class="mb-0">If you want reliable platforms, check out &lt;a href="https://example.com/"&gt;casino sites&lt;/a&gt; to see options.</p>
                                    </div>
                                    <small class="text-primary" style="font-size: 10px;">‚Üë –ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Äî –æ—Ç–¥–µ–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ —Å HTML –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ -->
                    <div>
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <label class="form-label-icon mb-0">
                                <i class="bi bi-file-text text-primary"></i>
                                –í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à–∏ —Å—Å—ã–ª–∫–∏
                            </label>
                            <span class="badge bg-primary" id="bulkLinesCount">0 —Å—Ç—Ä–æ–∫</span>
                        </div>
                        <textarea class="form-control font-monospace" id="bulkImportText" rows="10" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –±–ª–æ–∫–∏ —Å HTML —Å—Å—ã–ª–∫–∞–º–∏ (–∫–∞–∂–¥—ã–π –±–ª–æ–∫ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)..." style="font-size: 11px;" oninput="updateBulkLinesCount()"></textarea>
                    </div>
                </div>
                <div class="modal-footer d-flex gap-2" style="background: linear-gradient(135deg, #f9fafb 0%, #ecfeff 100%);">
                    <button type="button" class="btn btn-light px-4" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn btn-gradient-cyan flex-grow-1" onclick="parseBulkLinks()">
                        <i class="bi bi-cloud-upload me-1"></i> –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫–∏
                        <i class="bi bi-arrow-right ms-1"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Import Modal - Step 2: Preview (Reference Style) -->
    <div class="modal fade" id="bulkPreviewModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="border-radius: 1rem; overflow: hidden; max-height: 90vh; display: flex; flex-direction: column;">
                <!-- Header - White with border -->
                <div class="modal-header px-4 py-3 border-bottom bg-white" style="flex-shrink: 0;">
                    <h5 class="modal-title fw-semibold" style="color: #111827;">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–º–ø–æ—Ä—Ç–∞ —Å—Å—ã–ª–æ–∫</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <!-- Valid Links Header - Green gradient -->
                <div class="px-4 py-3 d-flex align-items-center gap-2" style="background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%); border-bottom: 2px solid #bbf7d0; flex-shrink: 0;">
                    <i class="bi bi-check-circle-fill" style="color: #16a34a; font-size: 1.25rem;"></i>
                    <span class="fw-semibold" style="color: #111827;">
                        –í–∞–ª–∏–¥–Ω—ã–µ —Å—Å—ã–ª–∫–∏ (<span id="validLinksCountHeader">0</span>):
                    </span>
                </div>

                <!-- Scrollable Content Area -->
                <div class="modal-body p-4" style="flex: 1; overflow-y: auto;">
                    <div id="bulkPreviewContent" class="d-flex flex-column gap-4"></div>
                </div>

                <!-- Footer - Gray background -->
                <div class="modal-footer px-4 py-3 d-flex gap-3" style="background: #f9fafb; border-top: 1px solid #e5e7eb; flex-shrink: 0;">
                    <button type="button" class="btn d-flex align-items-center gap-2 px-4 py-2" style="background: white; border: 2px solid #d1d5db; border-radius: 0.75rem; font-weight: 500; color: #374151;" onclick="backToBulkInput()">
                        <i class="bi bi-arrow-left"></i>
                        –ù–∞–∑–∞–¥
                    </button>
                    <button type="button" class="btn flex-grow-1 d-flex align-items-center justify-content-center gap-2 py-2" id="importLinksBtn" onclick="importBulkLinks()" disabled style="background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%); color: white; border: none; border-radius: 0.75rem; font-weight: 600;">
                        <i class="bi bi-check-circle"></i>
                        –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å (<span id="validLinksCount">0</span>)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sticky Delete Buttons (positioned fixed at bottom-right) -->
    <button id="deleteSelectedBtn" class="btn btn-danger delete-selected-btn" style="display: none;" onclick="deleteSelectedLinks()">
        <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ (<span class="count">0</span>)
    </button>
    <button id="deleteSelectedArticlesBtn" class="btn btn-danger delete-selected-btn" style="display: none;" onclick="deleteSelectedArticles()">
        <i class="bi bi-trash"></i> –£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ (<span class="count">0</span>)
    </button>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/security.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/sidebar.js"></script>
    <script>
        // Initialize sidebar navigation
        SidebarNav.init({
            activePage: 'projects',
            pageTitle: '–î–µ—Ç–∞–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞',
            pageSubtitle: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–∞',
            pageIcon: 'folder2-open',
            pageIconGradient: 'gradient-blue-indigo'
        });

        requireAuth();

        let projectId = null;
        let project = null;
        let links = [];
        let articles = [];

        // Highlight anchor text in HTML context with blue color (React reference style)
        // Parses HTML to extract plain text, then highlights the anchor
        function highlightAnchorInContext(context, anchor) {
            if (!context || !anchor) return escapeHtml(context || '');

            // 1. Create temp div to parse HTML
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = context;

            // 2. Get plain text (without tags)
            const plainText = tempDiv.textContent || tempDiv.innerText || '';

            // 3. Escape for XSS safety
            const escapedText = escapeHtml(plainText);
            const escapedAnchor = escapeHtml(anchor);

            // 4. Highlight anchor with blue color
            const regex = new RegExp(`(${escapedAnchor.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
            return escapedText.replace(regex, '<span class="anchor-highlight">$1</span>');
        }

        // Get project ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        projectId = parseInt(urlParams.get('id'));

        if (!projectId) {
            showNotification('ID –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω', 'error');
            setTimeout(() => window.location.href = '/projects.html', 2000);
        }

        // Load project data
        async function loadProject() {
            try {
                project = await ProjectsAPI.get(projectId);
                document.getElementById('projectName').textContent = project.name;
                // Show domain if available
                const domainEl = document.getElementById('projectDomain');
                if (domainEl && project.domain) {
                    domainEl.textContent = project.domain;
                }
            } catch (error) {
                console.error('Error loading project:', error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞', 'error');
            }
        }

        // Quick limit button helper
        function setQuickLimit(value) {
            document.getElementById('linkLimit').value = value;
            // Update button states
            document.querySelectorAll('.quick-limit-btn').forEach(btn => {
                btn.classList.remove('active');
                if ((value === 999 && btn.textContent === '‚àû') ||
                    (btn.textContent === String(value))) {
                    btn.classList.add('active');
                }
            });
        }

        // Update bulk import lines count
        function updateBulkLinesCount() {
            const text = document.getElementById('bulkImportText').value.trim();
            const lines = text ? text.split('\n').filter(l => l.trim()).length : 0;
            document.getElementById('bulkLinesCount').textContent = lines + ' —Å—Ç—Ä–æ–∫';
        }

        // Switch tab function
        function switchTab(tabId, clickedBtn) {
            // Update pill tabs
            document.querySelectorAll('.pill-tab').forEach(tab => tab.classList.remove('active'));
            clickedBtn.classList.add('active');

            // Update tab panels
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.style.display = 'none';
                panel.classList.remove('active');
            });
            const targetPanel = document.getElementById(tabId);
            if (targetPanel) {
                targetPanel.style.display = 'block';
                targetPanel.classList.add('active');
            }

            // Update add button text and action
            const addBtn = document.getElementById('addContentBtn');
            if (tabId === 'linksTab') {
                addBtn.innerHTML = '<i class="bi bi-plus-lg"></i> –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É';
                addBtn.onclick = showAddLinkModal;
            } else {
                addBtn.innerHTML = '<i class="bi bi-plus-lg"></i> –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—å—é';
                addBtn.onclick = showAddArticleModal;
            }
        }

        // Load links
        async function loadLinks() {
            try {
                links = await ProjectsAPI.getLinks(projectId);
                document.getElementById('linksCount').textContent = links.length;
                displayLinks();
            } catch (error) {
                console.error('Error loading links:', error);
                document.getElementById('linksList').innerHTML =
                    '<div class="alert alert-danger">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Å—ã–ª–æ–∫</div>';
            }
        }

        // Track selected links for deletion
        let selectedLinks = new Set();

        // Display links
        function displayLinks() {
            const list = document.getElementById('linksList');

            // Check admin status BEFORE map (so it's available in template string scope)
            const userIsAdmin = typeof isAdmin === 'function' ? isAdmin() : false;

            if (links.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-link-45deg d-block"></i>
                        <h5>–ù–µ—Ç —Å—Å—ã–ª–æ–∫</h5>
                        <p class="mb-3">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é —Å—Å—ã–ª–∫—É –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –Ω–∞ —Å–∞–π—Ç–∞—Ö</p>
                        <button class="btn btn-gradient" onclick="showAddLinkModal()">
                            <i class="bi bi-plus-lg me-1"></i> –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É
                        </button>
                    </div>
                `;
                updateStats();
                return;
            }

            list.innerHTML = `
                <div class="table-responsive">
                    <table class="table modern-table">
                        <thead>
                            <tr>
                                <th style="width: 40px;">
                                    <input type="checkbox" class="form-check-input" id="selectAllLinks" onchange="toggleAllLinks(this.checked)">
                                </th>
                                <th style="width: 60px;">ID</th>
                                <th style="width: 250px;">–ê–Ω–∫–æ—Ä</th>
                                <th>HTML –∫–æ–Ω—Ç–µ–∫—Å—Ç</th>
                                <th style="width: 120px;">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π</th>
                                <th style="width: 100px; text-align: center;">–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${links.map(link => {
                                const isExhausted = link.usage_count >= link.usage_limit;
                                const usageText = `${link.usage_count}/${link.usage_limit}`;

                                return `
                                    <tr class="${selectedLinks.has(link.id) ? 'table-active' : ''}"
                                        style="cursor: pointer; ${isExhausted ? 'opacity: 0.6;' : ''}"
                                        onclick="toggleRowSelection(${link.id}, 'link', event)">
                                        <td onclick="event.stopPropagation()">
                                            <input type="checkbox" class="form-check-input link-checkbox"
                                                   data-link-id="${link.id}"
                                                   ${selectedLinks.has(link.id) ? 'checked' : ''}
                                                   onchange="toggleLinkSelection(${link.id}, this.checked)">
                                        </td>
                                        <td><span class="mono-text" style="color: #3b82f6; font-weight: 600;">${link.id}</span></td>
                                        <td>
                                            <span style="font-weight: 600; color: #1e293b;">${escapeHtml(link.anchor_text)}</span>
                                        </td>
                                        <td>
                                            ${link.html_context ? `
                                                <div style="color: #334155; max-width: 400px; line-height: 1.5;">
                                                    ${highlightAnchorInContext(link.html_context, link.anchor_text)}
                                                </div>
                                            ` : '<span style="color: #94a3b8;">‚Äî</span>'}
                                        </td>
                                        <td>
                                            <span style="color: #334155;">${usageText}</span>
                                        </td>
                                        <td class="text-center" onclick="event.stopPropagation()">
                                            <div class="action-btns">
                                                <button class="action-btn edit" onclick="editLink(${link.id})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–Ω–∫–æ—Ä">
                                                    <i class="bi bi-pencil"></i>
                                                </button>
                                                <button class="action-btn delete" onclick="deleteLink(${link.id})" title="–£–¥–∞–ª–∏—Ç—å">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;

            updateDeleteButton();
            updateStats();
        }

        // Toggle individual link selection
        function toggleLinkSelection(linkId, isChecked) {
            if (isChecked) {
                selectedLinks.add(linkId);
            } else {
                selectedLinks.delete(linkId);
                // Uncheck "select all" if any item is unchecked
                const selectAllCheckbox = document.getElementById('selectAllLinks');
                if (selectAllCheckbox) selectAllCheckbox.checked = false;
            }
            updateDeleteButton();
            displayLinks(); // Re-render to update row highlighting
        }

        // Toggle all links selection
        function toggleAllLinks(isChecked) {
            if (isChecked) {
                links.forEach(link => selectedLinks.add(link.id));
            } else {
                selectedLinks.clear();
            }
            updateDeleteButton();
            displayLinks();
        }

        // Toggle row selection on click (universal function for links and articles)
        function toggleRowSelection(itemId, type, event) {
            // Prevent triggering when clicking on checkbox cell
            if (event.target.tagName === 'INPUT') {
                return;
            }

            if (type === 'link') {
                const isCurrentlySelected = selectedLinks.has(itemId);
                toggleLinkSelection(itemId, !isCurrentlySelected);
            } else if (type === 'article') {
                const isCurrentlySelected = selectedArticles.has(itemId);
                toggleArticleSelection(itemId, !isCurrentlySelected);
            }
        }

        // Update delete button visibility and count
        function updateDeleteButton() {
            const deleteBtn = document.getElementById('deleteSelectedBtn');
            const deleteArticlesBtn = document.getElementById('deleteSelectedArticlesBtn');
            if (!deleteBtn) return;

            if (selectedLinks.size > 0) {
                deleteBtn.style.display = 'block';
                deleteBtn.querySelector('.count').textContent = selectedLinks.size;
                // Hide articles button when links button is shown
                if (deleteArticlesBtn) deleteArticlesBtn.style.display = 'none';
            } else {
                deleteBtn.style.display = 'none';
            }
        }

        // Delete selected links
        async function deleteSelectedLinks() {
            if (selectedLinks.size === 0) return;

            if (!confirm(`–£–¥–∞–ª–∏—Ç—å ${selectedLinks.size} –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫?`)) return;

            try {
                const deletePromises = Array.from(selectedLinks).map(linkId =>
                    ProjectsAPI.deleteLink(projectId, linkId)
                );

                await Promise.all(deletePromises);
                showNotification(`–£—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ ${selectedLinks.size} —Å—Å—ã–ª–æ–∫`, 'success');
                selectedLinks.clear();
                await loadLinks();
            } catch (error) {
                console.error('Error deleting links:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å—Å—ã–ª–æ–∫', 'error');
            }
        }

        // Load articles
        async function loadArticles() {
            try {
                articles = await ProjectsAPI.getArticles(projectId);
                document.getElementById('articlesCount').textContent = articles.length;
                displayArticles();
            } catch (error) {
                console.error('Error loading articles:', error);
                document.getElementById('articlesList').innerHTML =
                    '<div class="alert alert-danger">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–µ—Å—Ç-–ø–æ—Å—Ç–æ–≤</div>';
            }
        }

        // Display articles
        // Track selected articles for deletion
        let selectedArticles = new Set();

        function displayArticles() {
            const list = document.getElementById('articlesList');

            // Check admin status BEFORE map (so it's available in template string scope)
            const userIsAdmin = typeof isAdmin === 'function' ? isAdmin() : false;

            if (articles.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-file-text d-block"></i>
                        <h5>–ù–µ—Ç –≥–µ—Å—Ç-–ø–æ—Å—Ç–æ–≤</h5>
                        <p class="mb-3">–î–æ–±–∞–≤—å—Ç–µ —Å—Ç–∞—Ç—å–∏ –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω–∞ WordPress —Å–∞–π—Ç–∞—Ö</p>
                        <button class="btn btn-gradient" onclick="showAddArticleModal()">
                            <i class="bi bi-plus-lg me-1"></i> –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—å—é
                        </button>
                    </div>
                `;
                updateStats();
                return;
            }

            list.innerHTML = `
                <div class="table-responsive">
                    <table class="table modern-table">
                        <thead>
                            <tr>
                                <th style="width: 40px;">
                                    <input type="checkbox" class="form-check-input" id="selectAllArticles" onchange="toggleAllArticles(this.checked)">
                                </th>
                                <th style="width: 60px;">ID</th>
                                <th>–ó–∞–≥–æ–ª–æ–≤–æ–∫</th>
                                <th style="width: 80px;">–°–ª–æ–≤</th>
                                <th style="width: 120px;">–°—Ç–∞—Ç—É—Å</th>
                                <th style="width: 140px; text-align: center;">–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${articles.map(article => {
                                const isExhausted = article.usage_count >= 1;
                                const wordCount = article.content.split(/\s+/).length;
                                const badgeClass = isExhausted ? 'exhausted' : 'available';
                                const badgeText = isExhausted ? '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω' : '–î–æ—Å—Ç—É–ø–µ–Ω';

                                return `
                                    <tr class="${selectedArticles.has(article.id) ? 'table-active' : ''}"
                                        style="cursor: pointer; ${isExhausted ? 'opacity: 0.6;' : ''}"
                                        onclick="toggleRowSelection(${article.id}, 'article', event)">
                                        <td onclick="event.stopPropagation()">
                                            <input type="checkbox" class="form-check-input article-checkbox"
                                                   data-article-id="${article.id}"
                                                   ${selectedArticles.has(article.id) ? 'checked' : ''}
                                                   onchange="toggleArticleSelection(${article.id}, this.checked)">
                                        </td>
                                        <td><span style="color: #6b7280; font-size: 12px;">#${article.id}</span></td>
                                        <td>
                                            <div style="font-weight: 500; color: #111827;">${escapeHtml(article.title)}</div>
                                            <div style="font-size: 12px; color: #9ca3af; margin-top: 2px;">${escapeHtml(article.content.substring(0, 60))}...</div>
                                        </td>
                                        <td>
                                            <span style="color: #6b7280; font-size: 13px;">
                                                <i class="bi bi-fonts me-1"></i>${wordCount}
                                            </span>
                                        </td>
                                        <td>
                                            <span class="usage-badge ${badgeClass}">
                                                ${badgeText}
                                            </span>
                                        </td>
                                        <td class="text-center" onclick="event.stopPropagation()">
                                            <div class="action-btns">
                                                <button class="action-btn view" onclick="viewArticle(${article.id})" title="–ü—Ä–æ—Å–º–æ—Ç—Ä">
                                                    <i class="bi bi-eye"></i>
                                                </button>
                                                <button class="action-btn edit" onclick="editArticle(${article.id})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                                    <i class="bi bi-pencil"></i>
                                                </button>
                                                <button class="action-btn duplicate" onclick="duplicateArticle(${article.id})" title="–î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å">
                                                    <i class="bi bi-copy"></i>
                                                </button>
                                                <button class="action-btn delete" onclick="deleteArticle(${article.id})" title="–£–¥–∞–ª–∏—Ç—å">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;

            updateDeleteArticlesButton();
            updateStats();
        }

        // Toggle individual article selection
        function toggleArticleSelection(articleId, isChecked) {
            if (isChecked) {
                selectedArticles.add(articleId);
            } else {
                selectedArticles.delete(articleId);
                const selectAllCheckbox = document.getElementById('selectAllArticles');
                if (selectAllCheckbox) selectAllCheckbox.checked = false;
            }
            updateDeleteArticlesButton();
            displayArticles();
        }

        // Toggle all articles selection
        function toggleAllArticles(isChecked) {
            if (isChecked) {
                articles.forEach(article => selectedArticles.add(article.id));
            } else {
                selectedArticles.clear();
            }
            updateDeleteArticlesButton();
            displayArticles();
        }

        // Update delete articles button
        function updateDeleteArticlesButton() {
            const deleteBtn = document.getElementById('deleteSelectedArticlesBtn');
            const deleteLinksBtn = document.getElementById('deleteSelectedBtn');
            if (!deleteBtn) return;

            if (selectedArticles.size > 0) {
                deleteBtn.style.display = 'block';
                deleteBtn.querySelector('.count').textContent = selectedArticles.size;
                // Hide links button when articles button is shown
                if (deleteLinksBtn) deleteLinksBtn.style.display = 'none';
            } else {
                deleteBtn.style.display = 'none';
            }
        }

        // Delete selected articles
        async function deleteSelectedArticles() {
            if (selectedArticles.size === 0) return;

            if (!confirm(`–£–¥–∞–ª–∏—Ç—å ${selectedArticles.size} –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –≥–µ—Å—Ç-–ø–æ—Å—Ç–æ–≤?`)) return;

            try {
                const deletePromises = Array.from(selectedArticles).map(articleId =>
                    ProjectsAPI.deleteArticle(projectId, articleId)
                );

                await Promise.all(deletePromises);
                showNotification(`–£—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ ${selectedArticles.size} –≥–µ—Å—Ç-–ø–æ—Å—Ç–æ–≤`, 'success');
                selectedArticles.clear();
                await loadArticles();
            } catch (error) {
                console.error('Error deleting articles:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –≥–µ—Å—Ç-–ø–æ—Å—Ç–æ–≤', 'error');
            }
        }

        // Modal functions
        function showAddLinkModal() {
            document.getElementById('linkModalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É';
            document.getElementById('linkForm').reset();
            document.getElementById('linkId').value = '';
            document.getElementById('linkLimit').value = '999';
            document.getElementById('linkHtmlContext').value = '';
            new bootstrap.Modal(document.getElementById('linkModal')).show();
        }

        function editLink(id) {
            const link = links.find(l => l.id === id);
            if (!link) return;

            document.getElementById('linkModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É';
            document.getElementById('linkId').value = link.id;
            document.getElementById('linkUrl').value = link.url;
            document.getElementById('linkAnchor').value = link.anchor_text;
            document.getElementById('linkHtmlContext').value = link.html_context || '';
            document.getElementById('linkLimit').value = link.usage_limit;
            new bootstrap.Modal(document.getElementById('linkModal')).show();
        }

        async function saveLink() {
            const id = document.getElementById('linkId').value;
            const url = document.getElementById('linkUrl').value.trim();
            const anchor = document.getElementById('linkAnchor').value.trim();
            const htmlContext = document.getElementById('linkHtmlContext').value.trim();
            const limit = parseInt(document.getElementById('linkLimit').value);

            if (!url || !anchor || !limit) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }

            try {
                const data = {
                    url,
                    anchor_text: anchor,
                    html_context: htmlContext || null,
                    usage_limit: limit
                };

                if (id) {
                    await ProjectsAPI.updateLink(projectId, id, data);
                    showNotification('–°—Å—ã–ª–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞', 'success');
                } else {
                    await ProjectsAPI.addLink(projectId, data);
                    showNotification('–°—Å—ã–ª–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞', 'success');
                }

                bootstrap.Modal.getInstance(document.getElementById('linkModal')).hide();
                loadLinks();
            } catch (error) {
                console.error('Error saving link:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏', 'error');
            }
        }

        async function deleteLink(id) {
            const link = links.find(l => l.id === id);
            if (!link) return;

            // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ —Å—Å—ã–ª–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞
            if (link.usage_count > 0) {
                const confirmMsg = `‚ö†Ô∏è –≠—Ç–∞ —Å—Å—ã–ª–∫–∞ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ ${link.usage_count} —Ä–∞–∑!\n\n` +
                                  `–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –≥–¥–µ –æ–Ω–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.\n\n` +
                                  `–í—ã —É–≤–µ—Ä–µ–Ω—ã —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å?`;
                if (!confirm(confirmMsg)) return;
            } else {
                if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Å—Å—ã–ª–∫—É?\n\n–í–Ω–∏–º–∞–Ω–∏–µ: —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!')) return;
            }

            try {
                await ProjectsAPI.deleteLink(projectId, id);
                showNotification('–°—Å—ã–ª–∫–∞ —É–¥–∞–ª–µ–Ω–∞', 'success');
                loadLinks();
            } catch (error) {
                console.error('Error deleting link:', error);
                showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å—Å—ã–ª–∫–∏', 'error');
            }
        }

        function showAddArticleModal() {
            document.getElementById('articleModalTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—å—é';
            document.getElementById('articleForm').reset();
            document.getElementById('articleId').value = '';
            new bootstrap.Modal(document.getElementById('articleModal')).show();
        }

        function editArticle(id) {
            const article = articles.find(a => a.id === id);
            if (!article) return;

            document.getElementById('articleModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—å—é';
            document.getElementById('articleId').value = article.id;
            document.getElementById('articleTitle').value = article.title;
            document.getElementById('articleContent').value = article.content;
            new bootstrap.Modal(document.getElementById('articleModal')).show();
        }

        function viewArticle(id) {
            const article = articles.find(a => a.id === id);
            if (!article) return;

            document.getElementById('viewArticleTitle').textContent = article.title;
            document.getElementById('viewArticleContent').textContent = article.content;
            new bootstrap.Modal(document.getElementById('viewArticleModal')).show();
        }

        async function saveArticle() {
            const id = document.getElementById('articleId').value;
            const title = document.getElementById('articleTitle').value.trim();
            const content = document.getElementById('articleContent').value.trim();

            if (!title || !content) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'error');
                return;
            }

            try {
                const data = { title, content };

                if (id) {
                    await ProjectsAPI.updateArticle(projectId, id, data);
                    showNotification('–ì–µ—Å—Ç-–ø–æ—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω', 'success');
                } else {
                    await ProjectsAPI.addArticle(projectId, data);
                    showNotification('–ì–µ—Å—Ç-–ø–æ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω', 'success');
                }

                bootstrap.Modal.getInstance(document.getElementById('articleModal')).hide();
                loadArticles();
            } catch (error) {
                console.error('Error saving article:', error);
                showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≥–µ—Å—Ç-–ø–æ—Å—Ç–∞', 'error');
            }
        }

        async function duplicateArticle(id) {
            const article = articles.find(a => a.id === id);
            if (!article) return;

            try {
                const data = {
                    title: article.title + ' (–∫–æ–ø–∏—è)',
                    content: article.content
                };
                await ProjectsAPI.addArticle(projectId, data);
                showNotification('–ì–µ—Å—Ç-–ø–æ—Å—Ç –ø—Ä–æ–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω', 'success');
                loadArticles();
            } catch (error) {
                console.error('Error duplicating article:', error);
                showNotification('–û—à–∏–±–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –≥–µ—Å—Ç-–ø–æ—Å—Ç–∞', 'error');
            }
        }

        async function deleteArticle(id) {
            const article = articles.find(a => a.id === id);
            if (!article) return;

            // –ü—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ –≥–µ—Å—Ç-–ø–æ—Å—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω, –∑–∞–ø—Ä–µ—Ç–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ
            if (article.usage_count >= 1) {
                alert('‚ùå –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π –≥–µ—Å—Ç-–ø–æ—Å—Ç!\n\n' +
                      '–≠—Ç–æ—Ç –≥–µ—Å—Ç-–ø–æ—Å—Ç —É–∂–µ —Ä–∞–∑–º–µ—â–µ–Ω –Ω–∞ —Å–∞–π—Ç–µ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è—Ö.\n\n' +
                      '–ß—Ç–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:\n' +
                      '‚Ä¢ –°–æ–∑–¥–∞—Ç—å –∫–æ–ø–∏—é –≥–µ—Å—Ç-–ø–æ—Å—Ç–∞ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É "–î—É–±–ª–∏—Ä–æ–≤–∞—Ç—å"\n' +
                      '‚Ä¢ –£–¥–∞–ª–∏—Ç—å —Å–Ω–∞—á–∞–ª–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥–µ—Å—Ç-–ø–æ—Å—Ç\n\n' +
                      '–≠—Ç–æ –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ª—É—á–∞–π–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞.');
                return;
            }

            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –≥–µ—Å—Ç-–ø–æ—Å—Ç?\n\n–í–Ω–∏–º–∞–Ω–∏–µ: —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!')) return;

            try {
                await ProjectsAPI.deleteArticle(projectId, id);
                showNotification('–ì–µ—Å—Ç-–ø–æ—Å—Ç —É–¥–∞–ª–µ–Ω', 'success');
                loadArticles();
            } catch (error) {
                console.error('Error deleting article:', error);
                showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≥–µ—Å—Ç-–ø–æ—Å—Ç–∞', 'error');
            }
        }

        // Update statistics cards
        function updateStats() {
            // Links stats
            const totalLinks = links.length;
            const usedLinks = links.filter(l => l.usage_count > 0).length;

            document.getElementById('statLinksTotal').textContent = totalLinks;

            // Articles stats
            const totalArticles = articles.length;
            const usedArticles = articles.filter(a => a.usage_count >= 1).length;

            document.getElementById('statArticlesTotal').textContent = totalArticles;

            // Active (used) count
            const activeCount = usedLinks + usedArticles;
            document.getElementById('statActiveTotal').textContent = activeCount;

            // Update link types (Homepage vs Article)
            // For now, we'll split used links roughly in half for display
            // In production, this would come from placement data
            const homepageCount = Math.floor(usedLinks / 2);
            const articleCount = usedLinks - homepageCount;

            const homepageEl = document.getElementById('homepageCount');
            const articleEl = document.getElementById('articleCount');
            if (homepageEl) homepageEl.textContent = homepageCount;
            if (articleEl) articleEl.textContent = articleCount;
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Bulk import functions
        let parsedLinks = [];

        function showBulkImportModal() {
            document.getElementById('bulkImportText').value = '';
            document.getElementById('bulkLinesCount').textContent = '0 —Å—Ç—Ä–æ–∫';
            new bootstrap.Modal(document.getElementById('bulkImportModal')).show();
        }

        function parseBulkLinks() {
            const text = document.getElementById('bulkImportText').value.trim();
            if (!text) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞');
                return;
            }

            // Split by single newline
            const blocks = text.split('\n').filter(b => b.trim());

            parsedLinks = blocks.map((block, index) => {
                block = block.trim();
                const validation = validateLinkBlock(block);

                return {
                    id: index,
                    html_context: block,
                    url: validation.url,
                    anchor_text: validation.anchor_text,
                    valid: validation.valid,
                    errors: validation.errors
                };
            });

            showPreview();
        }

        function validateLinkBlock(block) {
            const errors = [];
            let valid = true;
            let url = null;
            let anchor_text = null;

            // Check length
            if (block.length < 30) {
                errors.push('–¢–µ–∫—Å—Ç —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π (–º–∏–Ω–∏–º—É–º 30 —Å–∏–º–≤–æ–ª–æ–≤)');
                valid = false;
            }
            if (block.length > 250) {
                errors.push('–¢–µ–∫—Å—Ç —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π (–º–∞–∫—Å–∏–º—É–º 250 —Å–∏–º–≤–æ–ª–æ–≤)');
                valid = false;
            }

            // Check for <a> tag
            const linkRegex = /<a\s+href=["']([^"']+)["'][^>]*>([^<]+)<\/a>/i;
            const match = block.match(linkRegex);

            if (!match) {
                errors.push('HTML —Ç–µ–≥ <a href="...">–∞–Ω–∫–æ—Ä</a> –Ω–µ –Ω–∞–π–¥–µ–Ω');
                valid = false;
            } else {
                url = match[1];
                anchor_text = match[2];

                // Validate URL
                if (!url.startsWith('http')) {
                    errors.push('URL –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å http:// –∏–ª–∏ https://');
                    valid = false;
                }

                // Validate anchor text
                if (!anchor_text || anchor_text.trim().length === 0) {
                    errors.push('–ê–Ω–∫–æ—Ä –Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É—Å—Ç—ã–º');
                    valid = false;
                }
            }

            return { valid, errors, url, anchor_text };
        }

        function showPreview() {
            const validLinks = parsedLinks.filter(l => l.valid);
            const invalidLinks = parsedLinks.filter(l => !l.valid);

            let html = '';

            // Helper function to highlight anchor in context (blue + underline)
            function highlightAnchorInPreview(context, anchor) {
                if (!context || !anchor) return escapeHtml(context || '');

                // Parse HTML to get plain text
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = context;
                const plainText = tempDiv.textContent || tempDiv.innerText || '';

                // Find and highlight anchor (case-insensitive)
                const escapedAnchor = anchor.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                const regex = new RegExp(`(${escapedAnchor})`, 'gi');

                return escapeHtml(plainText).replace(regex,
                    '<span style="color: #2563eb; font-weight: 500; text-decoration: underline;">$1</span>'
                );
            }

            // Render valid links in reference style
            if (validLinks.length > 0) {
                validLinks.forEach(link => {
                    html += `
                        <div class="pb-4" style="border-bottom: 1px solid #e5e7eb;">
                            <!-- URL Row -->
                            <div class="d-flex align-items-start gap-2 mb-3">
                                <div class="d-flex align-items-center justify-content-center flex-shrink-0" style="width: 24px; height: 24px; background: #22c55e; border-radius: 50%; margin-top: 2px;">
                                    <i class="bi bi-check" style="color: white; font-size: 14px;"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <div class="d-flex align-items-baseline gap-2 flex-wrap">
                                        <span class="fw-semibold" style="color: #111827;">URL:</span>
                                        <a href="${escapeHtml(link.url)}" target="_blank" rel="noopener noreferrer" style="color: #2563eb; word-break: break-all;">
                                            ${escapeHtml(link.url)}
                                        </a>
                                    </div>
                                </div>
                            </div>

                            <!-- Anchor Row -->
                            <div style="padding-left: 32px; margin-bottom: 12px;">
                                <div class="d-flex align-items-baseline gap-2">
                                    <span class="fw-semibold" style="color: #111827;">–ê–Ω–∫–æ—Ä:</span>
                                    <span style="color: #db2777; font-weight: 500;">${escapeHtml(link.anchor_text)}</span>
                                </div>
                            </div>

                            <!-- Context Row -->
                            <div style="padding-left: 32px;">
                                <div class="mb-2">
                                    <span class="fw-semibold" style="color: #111827;">–ö–æ–Ω—Ç–µ–∫—Å—Ç:</span>
                                </div>
                                <div style="background: #f9fafb; border-radius: 0.5rem; padding: 12px; border: 1px solid #e5e7eb;">
                                    <p style="font-size: 14px; color: #374151; line-height: 1.6; margin: 0;">
                                        ${highlightAnchorInPreview(link.html_context, link.anchor_text)}
                                    </p>
                                </div>
                                <p style="font-size: 12px; color: #6b7280; margin: 8px 0 0 0;">–î–ª–∏–Ω–∞: ${link.html_context.length} —Å–∏–º–≤–æ–ª–æ–≤</p>
                            </div>
                        </div>
                    `;
                });
            }

            // Render invalid links if any
            if (invalidLinks.length > 0) {
                html += `
                    <div class="mt-4 px-4 py-3 d-flex align-items-center gap-2" style="background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); border-bottom: 2px solid #fecaca; border-radius: 0.5rem; margin-bottom: 16px;">
                        <i class="bi bi-x-circle-fill" style="color: #dc2626; font-size: 1.25rem;"></i>
                        <span class="fw-semibold" style="color: #111827;">
                            –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ —Å—Å—ã–ª–∫–∏ (${invalidLinks.length}):
                        </span>
                    </div>
                `;
                invalidLinks.forEach(link => {
                    html += `
                        <div class="pb-4 mb-4" style="border-bottom: 1px solid #fecaca;">
                            <div class="d-flex align-items-start gap-2 mb-3">
                                <div class="d-flex align-items-center justify-content-center flex-shrink-0" style="width: 24px; height: 24px; background: #ef4444; border-radius: 50%; margin-top: 2px;">
                                    <i class="bi bi-x" style="color: white; font-size: 14px;"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <div class="mb-2">
                                        <span class="fw-semibold" style="color: #111827;">–¢–µ–∫—Å—Ç:</span>
                                    </div>
                                    <div style="background: #fef2f2; border-radius: 0.5rem; padding: 12px; border: 1px solid #fecaca;">
                                        <p style="font-size: 14px; color: #374151; line-height: 1.6; margin: 0;">${escapeHtml(link.html_context)}</p>
                                    </div>
                                    <p style="font-size: 12px; color: #6b7280; margin: 8px 0 0 0;">–î–ª–∏–Ω–∞: ${link.html_context.length} —Å–∏–º–≤–æ–ª–æ–≤</p>
                                    <div style="background: #fee2e2; border-radius: 0.5rem; padding: 12px; margin-top: 12px; border: 1px solid #fecaca;">
                                        <strong style="color: #991b1b;">–û—à–∏–±–∫–∏:</strong>
                                        <ul style="margin: 8px 0 0 0; padding-left: 20px; color: #991b1b;">
                                            ${link.errors.map(e => '<li>' + escapeHtml(e) + '</li>').join('')}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }

            document.getElementById('bulkPreviewContent').innerHTML = html;
            document.getElementById('validLinksCount').textContent = validLinks.length;
            document.getElementById('validLinksCountHeader').textContent = validLinks.length;
            document.getElementById('importLinksBtn').disabled = validLinks.length === 0;

            // Close first modal, show preview
            bootstrap.Modal.getInstance(document.getElementById('bulkImportModal')).hide();
            new bootstrap.Modal(document.getElementById('bulkPreviewModal')).show();
        }

        function backToBulkInput() {
            bootstrap.Modal.getInstance(document.getElementById('bulkPreviewModal')).hide();
            new bootstrap.Modal(document.getElementById('bulkImportModal')).show();
        }

        async function importBulkLinks() {
            const validLinks = parsedLinks.filter(l => l.valid);

            if (validLinks.length === 0) {
                alert('–ù–µ—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞');
                return;
            }

            const btn = document.getElementById('importLinksBtn');
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>–ò–º–ø–æ—Ä—Ç...';

            try {
                const links = validLinks.map(link => ({
                    url: link.url,
                    anchor_text: link.anchor_text,
                    html_context: link.html_context,
                    usage_limit: 1
                }));

                const response = await fetch(`/api/projects/${projectId}/links/bulk`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${getAuthToken()}`
                    },
                    body: JSON.stringify({ links })
                });

                const data = await response.json();

                if (response.ok) {
                    bootstrap.Modal.getInstance(document.getElementById('bulkPreviewModal')).hide();

                    // Build detailed success message
                    let message = `–£—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${data.summary.imported} –∏–∑ ${data.summary.total} —Å—Å—ã–ª–æ–∫`;

                    if (data.invalidUrls && data.invalidUrls.length > 0) {
                        message += `\n\n–ü—Ä–æ–ø—É—â–µ–Ω–æ –Ω–µ–≤–µ—Ä–Ω—ã—Ö URL: ${data.invalidUrls.length}`;

                        const showCount = Math.min(data.invalidUrls.length, 5);
                        for (let i = 0; i < showCount; i++) {
                            const inv = data.invalidUrls[i];
                            message += `\n  ‚Ä¢ –°—Ç—Ä–æ–∫–∞ ${inv.line}: ${inv.url}`;
                        }
                        if (data.invalidUrls.length > 5) {
                            message += `\n  ... –∏ –µ—â—ë ${data.invalidUrls.length - 5}`;
                        }
                    }

                    alert(message);
                    loadLinks(); // Reload links list
                } else {
                    throw new Error(data.error || '–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞');
                }
            } catch (error) {
                // Error message already contains detailed info from backend
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ:\n\n' + error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="bi bi-check-circle"></i> –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å (<span id="validLinksCount">' + validLinks.length + '</span>)';
            }
        }

        // Initialize
        console.log('=== Admin Check Debug ===');
        console.log('isAdmin function exists:', typeof isAdmin);
        console.log('getCurrentUser:', getCurrentUser());
        console.log('isAdmin():', typeof isAdmin === 'function' ? isAdmin() : 'function not available');
        console.log('========================');

        loadProject();
        loadLinks();
        loadArticles();
    </script>
</body>
</html>
